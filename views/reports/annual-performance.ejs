<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    /* ë³´ê³ ì„œ ì „ìš© ìŠ¤íƒ€ì¼ */
    body {
      font-family: 'Malgun Gothic', sans-serif;
      background: #fff;
      color: #333;
      line-height: 1.6;
    }

    .report-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .report-header {
      text-align: center;
      margin-bottom: 50px;
      padding-bottom: 30px;
      border-bottom: 3px solid #2c3e50;
    }

    .report-header h1 {
      font-size: 32px;
      color: #2c3e50;
      margin-bottom: 10px;
      font-weight: bold;
    }

    .report-header .subtitle {
      font-size: 18px;
      color: #7f8c8d;
      margin-bottom: 20px;
    }

    .report-header .meta {
      font-size: 14px;
      color: #95a5a6;
    }

    .section {
      margin-bottom: 50px;
      page-break-inside: avoid;
    }

    .section-title {
      font-size: 24px;
      color: #2c3e50;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #3498db;
      font-weight: bold;
    }

    .section-subtitle {
      font-size: 18px;
      color: #34495e;
      margin: 30px 0 15px 0;
      font-weight: bold;
    }

    .overview-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .overview-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 25px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .overview-card.blue {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .overview-card.green {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .overview-card.orange {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .overview-card.purple {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .overview-card .label {
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 10px;
    }

    .overview-card .value {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .overview-card .subvalue {
      font-size: 14px;
      opacity: 0.8;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      background: white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .data-table thead {
      background: #34495e;
      color: white;
    }

    .data-table th {
      padding: 12px;
      text-align: left;
      font-weight: bold;
      font-size: 14px;
    }

    .data-table td {
      padding: 12px;
      border-bottom: 1px solid #ecf0f1;
      font-size: 13px;
    }

    .data-table tbody tr:hover {
      background: #f8f9fa;
    }

    .data-table tbody tr:nth-child(even) {
      background: #f9f9f9;
    }

    .chart-container {
      margin: 30px 0;
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .chart-wrapper {
      position: relative;
      height: 400px;
    }

    .insights-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }

    .insight-card {
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #3498db;
      background: #ecf0f1;
    }

    .insight-card.success {
      border-left-color: #27ae60;
      background: #d5f4e6;
    }

    .insight-card.warning {
      border-left-color: #f39c12;
      background: #fef5e7;
    }

    .insight-card.info {
      border-left-color: #3498db;
      background: #ebf5fb;
    }

    .insight-card .title {
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 10px;
    }

    .insight-card .description {
      font-size: 14px;
      color: #555;
      line-height: 1.5;
    }

    .insight-card .metric {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
      margin-top: 10px;
    }

    .no-print {
      margin: 20px 0;
      text-align: center;
    }

    .no-print button {
      padding: 12px 30px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
      margin: 0 10px;
    }

    .no-print button:hover {
      background: #2980b9;
    }

    .highlight {
      background: #fff3cd;
      padding: 2px 6px;
      border-radius: 3px;
      font-weight: bold;
    }

    .text-right {
      text-align: right;
    }

    .text-center {
      text-align: center;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
    }

    .badge.excellent {
      background: #27ae60;
      color: white;
    }

    .badge.regular {
      background: #95a5a6;
      color: white;
    }

    /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
    @media print {
      body {
        background: white;
        font-size: 11pt;
      }

      .report-container {
        max-width: 100%;
        padding: 0;
      }

      .no-print {
        display: none !important;
      }

      .section {
        page-break-inside: avoid;
      }

      .chart-wrapper {
        height: 300px;
      }

      .overview-card {
        break-inside: avoid;
      }

      .data-table {
        font-size: 10pt;
      }

      .data-table th,
      .data-table td {
        padding: 8px;
      }

      @page {
        margin: 2cm;
      }
    }
  </style>
</head>
<body>
  <div class="report-container">
    <!-- í—¤ë” -->
    <div class="report-header">
      <h1><%= year %>ë…„ ê²Œì„ë”í•˜ê¸° ì‚¬ì—… ì„±ê³¼ ë³´ê³ ì„œ</h1>
      <div class="subtitle">Game Plus Business Performance Report</div>
      <div class="meta">
        ìƒì„±ì¼: <%= new Date(reportData.generatedAt).toLocaleDateString('ko-KR') %>
      </div>
    </div>

    <!-- ì¸ì‡„ ë²„íŠ¼ (í™”ë©´ì—ë§Œ í‘œì‹œ) -->
    <div class="no-print">
      <button onclick="window.print()">ğŸ“„ ë³´ê³ ì„œ ì¸ì‡„</button>
      <button onclick="location.href='/'">ğŸ  ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</button>
    </div>

    <!-- 1. ì‚¬ì—… ê°œìš” -->
    <section class="section">
      <h2 class="section-title">1. ì‚¬ì—… ê°œìš”</h2>
      
      <div class="overview-grid">
        <div class="overview-card blue">
          <div class="label">ì°¸ì—¬ ê²Œì„ì‚¬</div>
          <div class="value"><%= reportData.overview.companyCount %></div>
          <div class="subvalue">ê°œ ê²Œì„ì‚¬ (<%= reportData.overview.gameCount %>ê°œ ê²Œì„)</div>
        </div>
        
        <div class="overview-card green">
          <div class="label">ì´ ì§€ì› í¬ì¸íŠ¸</div>
          <div class="value"><%= reportData.overview.totalPoints.toLocaleString('ko-KR') %></div>
          <div class="subvalue">ì›</div>
        </div>
        
        <div class="overview-card orange">
          <div class="label">ê³„ì•½ ê±´ìˆ˜</div>
          <div class="value"><%= reportData.overview.confirmedContractCount %> / <%= reportData.overview.contractCount %></div>
          <div class="subvalue">ê±´ (í™•ì • / ì´)</div>
        </div>
        
        <div class="overview-card purple">
          <div class="label">í¬ì¸íŠ¸ ì‚¬ìš©ì•¡</div>
          <div class="value"><%= reportData.overview.totalPointsUsed.toLocaleString('ko-KR') %></div>
          <div class="subvalue">ì› (ì§‘í–‰ë¥  <%= reportData.overview.pointExecutionRate.toLocaleString('ko-KR') %>%)</div>
        </div>
      </div>

      <p style="margin-top: 30px; line-height: 1.8;">
        <%= year %>ë…„ ê²Œì„ë”í•˜ê¸° ì‚¬ì—…ì€ <span class="highlight"><%= reportData.overview.companyCount %>ê°œ ê²Œì„ì‚¬</span>ë¥¼ ëŒ€ìƒìœ¼ë¡œ 
        ì´ <span class="highlight"><%= reportData.overview.totalPoints.toLocaleString('ko-KR') %>ì›</span>ì˜ í¬ì¸íŠ¸ë¥¼ ì§€ì›í•˜ì˜€ìœ¼ë©°, 
        ì´ ì¤‘ <span class="highlight"><%= reportData.overview.excellentCompanyCount %>ê°œ ê²Œì„ì‚¬</span>ê°€ ìš°ìˆ˜ê²Œì„ì‚¬ë¡œ ì„ ì •ë˜ì–´ 
        ì¶”ê°€ ì§€ì›ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. ì´ <span class="highlight"><%= reportData.overview.contractCount %>ê±´</span>ì˜ ê³„ì•½ì´ ë“±ë¡ë˜ì—ˆê³ ,
        ì´ ì¤‘ <span class="highlight"><%= reportData.overview.confirmedContractCount %>ê±´</span>ì´ í™•ì •ë˜ì–´ 
        <span class="highlight"><%= reportData.overview.totalPointsUsed.toLocaleString('ko-KR') %>ì›</span>ì˜ í¬ì¸íŠ¸ê°€ ì‚¬ìš©ë˜ì—ˆìŠµë‹ˆë‹¤
        (ì§‘í–‰ë¥  <span class="highlight"><%= reportData.overview.pointExecutionRate.toLocaleString('ko-KR') %>%</span>).
      </p>
    </section>

    <!-- 2. í¬ì¸íŠ¸ ì§€ì› í˜„í™© -->
    <section class="section">
      <h2 class="section-title">2. í¬ì¸íŠ¸ ì§€ì› í˜„í™©</h2>

      <h3 class="section-subtitle">2.1 ì„œë¹„ìŠ¤ ë¶€ë¬¸ë³„ í¬ì¸íŠ¸ ë°°ë¶„</h3>
      <div class="chart-container">
        <div class="chart-wrapper">
          <canvas id="serviceCategoryChart"></canvas>
        </div>
      </div>

      <h3 class="section-subtitle">2.2 ê²Œì„ì‚¬ë³„ í¬ì¸íŠ¸ ë°°ë¶„ ë° ì‚¬ìš© í˜„í™©</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>ìˆœìœ„</th>
            <th>ê²Œì„ì‚¬</th>
            <th class="text-right">ì´ í¬ì¸íŠ¸</th>
            <th class="text-right">ì‚¬ìš© í¬ì¸íŠ¸</th>
            <th class="text-right">ì”ì—¬ í¬ì¸íŠ¸</th>
            <th class="text-right">ì‚¬ìš©ë¥ </th>
            <th class="text-center no-print">ë³´ê³ ì„œ</th>
          </tr>
        </thead>
        <tbody>
          <% reportData.pointSupport.companyPointDistribution.forEach((company, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" style="color: #2c3e50; text-decoration: none;">
                <%= company.companyName %>
              </a>
            </td>
            <td class="text-right"><%= (company.totalPoints / 100000000).toFixed(2) %>ì–µì›</td>
            <td class="text-right"><%= (company.usedPoints / 100000000).toFixed(2) %>ì–µì›</td>
            <td class="text-right"><%= (company.remainingPoints / 100000000).toFixed(2) %>ì–µì›</td>
            <td class="text-right"><strong><%= company.usageRate.toFixed(1) %>%</strong></td>
            <td class="text-center no-print">
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" class="btn btn-sm btn-outline-primary" title="ì„±ê³¼ ë³´ê³ ì„œ ë³´ê¸°">
                ğŸ“Š
              </a>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </section>

    <!-- 3. ê²Œì„ì‚¬ ì„±ê³¼ ë¶„ì„ -->
    <section class="section">
      <h2 class="section-title">3. ê²Œì„ì‚¬ ì„±ê³¼ ë¶„ì„</h2>
      
      <h3 class="section-subtitle">3.1 ì›”ë³„ ì„±ê³¼ ì¶”ì´</h3>
      <div class="chart-container">
        <div class="chart-wrapper">
          <canvas id="monthlyTrendChart"></canvas>
        </div>
      </div>

      <h3 class="section-subtitle">3.2 ê²Œì„ì‚¬ë³„ ì£¼ìš” ì„±ê³¼ ì§€í‘œ</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>ìˆœìœ„</th>
            <th>ê²Œì„ì‚¬</th>
            <th class="text-right">ê¸€ë¡œë²Œ ë§¤ì¶œ</th>
            <th class="text-right">ê¸€ë¡œë²Œ ë‹¤ìš´ë¡œë“œ</th>
            <th class="text-right">ê¸€ë¡œë²Œ DAU</th>
            <th class="text-right">ë§¤ì¶œ ë¹„ì¤‘</th>
            <th class="text-center no-print">ë³´ê³ ì„œ</th>
          </tr>
        </thead>
        <tbody>
          <% reportData.performance.companyPerformance.forEach((company, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" style="color: #2c3e50; text-decoration: none;">
                <%= company.companyName %>
              </a>
            </td>
            <td class="text-right"><%= Math.round(company.revenue.global).toLocaleString() %>ì›</td>
            <td class="text-right"><%= company.downloads.global.toLocaleString() %></td>
            <td class="text-right"><%= company.dau.global.toLocaleString() %></td>
            <td class="text-right">
              <strong style="color: #3498db">
                <%= company.revenue.shareRate.toFixed(1) %>%
              </strong>
            </td>
            <td class="text-center no-print">
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" class="btn btn-sm btn-outline-primary" title="ì„±ê³¼ ë³´ê³ ì„œ ë³´ê¸°">
                ğŸ“Š
              </a>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>

      <div style="margin-top: 30px; padding: 20px; background: #ecf0f1; border-radius: 8px;">
        <h4 style="margin-bottom: 15px; color: #2c3e50;">ğŸ“Š ì „ì²´ ê¸€ë¡œë²Œ ì„±ê³¼ ìš”ì•½</h4>
        <ul style="line-height: 2;">
          <li><strong>ì´ ë§¤ì¶œ:</strong> <%= Math.round(reportData.performance.totalPerformance.revenue).toLocaleString() %>ì›</li>
          <li><strong>ì´ ë‹¤ìš´ë¡œë“œ:</strong> <%= reportData.performance.totalPerformance.downloads.toLocaleString() %>íšŒ</li>
          <li><strong>í‰ê·  DAU:</strong> <%= Math.round(reportData.performance.totalPerformance.dau).toLocaleString() %>ëª…</li>
          <li><strong>ì´ ìœ„ì‹œë¦¬ìŠ¤íŠ¸:</strong> <%= reportData.performance.totalPerformance.wishlist.toLocaleString() %>ê°œ</li>
        </ul>
      </div>
    </section>

    <!-- 4. í¬ì¸íŠ¸ íš¨ìœ¨ì„± ë¶„ì„ (ROI) -->
    <section class="section">
      <h2 class="section-title">4. í¬ì¸íŠ¸ íš¨ìœ¨ì„± ë¶„ì„ (ROI)</h2>
      
      <h3 class="section-subtitle">4.1 ê²Œì„ì‚¬ë³„ íˆ¬ì íš¨ìœ¨ì„± (ROI)</h3>
      <div class="chart-container">
        <div class="chart-wrapper">
          <canvas id="roiChart"></canvas>
        </div>
      </div>

      <h3 class="section-subtitle">4.2 ìš°ìˆ˜ê²Œì„ì‚¬ vs ì¼ë°˜ê²Œì„ì‚¬ íš¨ìœ¨ì„± ë¹„êµ</h3>
      <div class="overview-grid" style="grid-template-columns: repeat(3, 1fr);">
        <div class="overview-card green">
          <div class="label">ìš°ìˆ˜ê²Œì„ì‚¬ í‰ê·  ROI</div>
          <div class="value"><%= reportData.efficiency.comparison.excellentAvgROI.toFixed(2) %></div>
          <div class="subvalue">ë°°</div>
        </div>
        
        <div class="overview-card blue">
          <div class="label">ì¼ë°˜ê²Œì„ì‚¬ í‰ê·  ROI</div>
          <div class="value"><%= reportData.efficiency.comparison.regularAvgROI.toFixed(2) %></div>
          <div class="subvalue">ë°°</div>
        </div>
        
        <div class="overview-card purple">
          <div class="label">ì „ì²´ í‰ê·  ROI</div>
          <div class="value"><%= reportData.efficiency.comparison.overallROI.toFixed(2) %></div>
          <div class="subvalue">ë°°</div>
        </div>
      </div>

      <h3 class="section-subtitle">4.3 ê²Œì„ì‚¬ë³„ ìƒì„¸ íš¨ìœ¨ì„± ì§€í‘œ</h3>
      <table class="data-table">
        <thead>
          <tr>
            <th>ìˆœìœ„</th>
            <th>ê²Œì„ì‚¬</th>
            <th>êµ¬ë¶„</th>
            <th class="text-right">íˆ¬ì… í¬ì¸íŠ¸</th>
            <th class="text-right">ì´ ë§¤ì¶œ</th>
            <th class="text-right">ROI</th>
            <th class="text-right">1ì–µì›ë‹¹ ë‹¤ìš´ë¡œë“œ</th>
            <th class="text-center no-print">ë³´ê³ ì„œ</th>
          </tr>
        </thead>
        <tbody>
          <% reportData.efficiency.companyEfficiency.forEach((company, index) => { %>
          <tr>
            <td><%= index + 1 %></td>
            <td>
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" style="color: #2c3e50; text-decoration: none;">
                <%= company.companyName %>
              </a>
            </td>
            <td>
              <% if (company.isExcellent) { %>
                <span class="badge excellent">ìš°ìˆ˜</span>
              <% } else { %>
                <span class="badge regular">ì¼ë°˜</span>
              <% } %>
            </td>
            <td class="text-right"><%= Math.round(company.totalPointsAllocated).toLocaleString('ko-KR') %>ì›</td>
            <td class="text-right"><%= Math.round(company.totalRevenue).toLocaleString('ko-KR') %>ì›</td>
            <td class="text-right"><strong><%= company.roi.toFixed(2) %>ë°°</strong></td>
            <td class="text-right"><%= Math.round(company.downloadsPerPoint).toLocaleString() %>íšŒ</td>
            <td class="text-center no-print">
              <a href="/reports/company/<%= encodeURIComponent(company.companyName) %>" class="btn btn-sm btn-outline-primary" title="ì„±ê³¼ ë³´ê³ ì„œ ë³´ê¸°">
                ğŸ“Š
              </a>
            </td>
          </tr>
          <% }); %>
        </tbody>
      </table>
    </section>

    <!-- 5. ì£¼ìš” ì¸ì‚¬ì´íŠ¸ ë° ì„±ê³¼ -->
    <section class="section">
      <h2 class="section-title">5. ì£¼ìš” ì¸ì‚¬ì´íŠ¸ ë° ì„±ê³¼</h2>
      
      <div class="insights-grid">
        <% reportData.insights.forEach((insight, index) => { %>
        <div class="insight-card <%= insight.type %>">
          <div class="title">ğŸ’¡ <%= insight.title %></div>
          <div class="description"><%= insight.description %></div>
          <div class="metric"><%= insight.metric %></div>
        </div>
        <% }); %>
      </div>

      <div style="margin-top: 40px; padding: 30px; background: #2c3e50; color: white; border-radius: 8px;">
        <h3 style="margin-bottom: 20px; font-size: 20px;">ğŸ“Œ ì¢…í•© ê²°ë¡ </h3>
        <p style="line-height: 1.8; font-size: 15px;">
          <%= year %>ë…„ ê²Œì„ë”í•˜ê¸° ì‚¬ì—…ì€ <strong><%= reportData.overview.companyCount %>ê°œ ê²Œì„ì‚¬</strong>ì— 
          ì´ <strong><%= (reportData.overview.totalPoints / 100000000).toFixed(1) %>ì–µì›</strong>ì„ ì§€ì›í•˜ì—¬ 
          <strong><%= (reportData.performance.totalPerformance.revenue / 100000000).toFixed(1) %>ì–µì›</strong>ì˜ ë§¤ì¶œ ì„±ê³¼ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤. 
          í‰ê·  ROI <strong><%= reportData.efficiency.comparison.overallROI.toFixed(2) %>ë°°</strong>ë¥¼ ê¸°ë¡í•˜ë©°, 
          íŠ¹íˆ ìš°ìˆ˜ê²Œì„ì‚¬ì˜ ê²½ìš° <strong><%= reportData.efficiency.comparison.excellentAvgROI.toFixed(2) %>ë°°</strong>ì˜ 
          ë†’ì€ íˆ¬ì íš¨ìœ¨ì„±ì„ ë³´ì—¬ ì‚¬ì—…ì˜ ì„±ê³µì ì¸ ìš´ì˜ì„ ì…ì¦í–ˆìŠµë‹ˆë‹¤.
        </p>
      </div>
    </section>

    <!-- í‘¸í„° -->
    <div style="margin-top: 50px; padding-top: 30px; border-top: 2px solid #ecf0f1; text-align: center; color: #95a5a6;">
      <p>ë³¸ ë³´ê³ ì„œëŠ” ê²Œì„ë”í•˜ê¸° ì‚¬ì—… ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œì„ í†µí•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
      <p>Â© <%= year %> ê²Œì„ë”í•˜ê¸° ì‚¬ì—… ìš´ì˜ì‚¬. All rights reserved.</p>
    </div>
  </div>

  <script>
    // Chart.js ì„¤ì •
    const chartColors = {
      blue: 'rgba(52, 152, 219, 0.8)',
      green: 'rgba(39, 174, 96, 0.8)',
      orange: 'rgba(243, 156, 18, 0.8)',
      purple: 'rgba(155, 89, 182, 0.8)',
      red: 'rgba(231, 76, 60, 0.8)'
    };

    // ë°ì´í„° í™•ì¸
    console.log('Report Data:', <%- JSON.stringify(reportData) %>);

    // 1. ì„œë¹„ìŠ¤ ë¶€ë¬¸ë³„ í¬ì¸íŠ¸ ë°°ë¶„ ì°¨íŠ¸
    try {
      const serviceCategoryCtx = document.getElementById('serviceCategoryChart');
      if (serviceCategoryCtx && <%= reportData.pointSupport.serviceCategoryStats ? 'true' : 'false' %>) {
        const categories = <%- JSON.stringify(reportData.pointSupport.serviceCategoryStats.categories || []) %>;
        new Chart(serviceCategoryCtx.getContext('2d'), {
          type: 'bar',
          data: {
            labels: categories.map(c => c.category),
            datasets: [{
              label: 'ì‚¬ìš© í¬ì¸íŠ¸ (ì–µì›)',
              data: categories.map(c => c.amount / 100000000),
              backgroundColor: chartColors.blue
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false
              },
              title: {
                display: true,
                text: 'ì„œë¹„ìŠ¤ ë¶€ë¬¸ë³„ í¬ì¸íŠ¸ ì‚¬ìš©ì•¡'
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: 'ì–µì›'
                }
              }
            }
          }
        });
      }
    } catch (error) {
      console.error('ì„œë¹„ìŠ¤ ë¶€ë¬¸ë³„ ì°¨íŠ¸ ì˜¤ë¥˜:', error);
    }

    // 2. ì›”ë³„ ì„±ê³¼ ì¶”ì´ ì°¨íŠ¸
    try {
      const monthlyTrendCtx = document.getElementById('monthlyTrendChart');
      if (monthlyTrendCtx && <%= reportData.monthlyTrends ? 'true' : 'false' %>) {
        const monthlyData = <%- JSON.stringify(reportData.monthlyTrends || []) %>;
        new Chart(monthlyTrendCtx.getContext('2d'), {
          type: 'line',
          data: {
            labels: monthlyData.map(m => m.monthName),
            datasets: [
              {
                label: 'ë§¤ì¶œ (ì–µì›)',
                data: monthlyData.map(m => m.revenue / 100000000),
                borderColor: chartColors.green,
                backgroundColor: 'rgba(39, 174, 96, 0.1)',
                yAxisID: 'y'
              },
              {
                label: 'ë‹¤ìš´ë¡œë“œ (ë§ŒíšŒ)',
                data: monthlyData.map(m => m.downloads / 10000),
                borderColor: chartColors.blue,
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                yAxisID: 'y1'
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: 'index',
              intersect: false
            },
            plugins: {
              title: {
                display: true,
                text: 'ì›”ë³„ ë§¤ì¶œ ë° ë‹¤ìš´ë¡œë“œ ì¶”ì´'
              }
            },
            scales: {
              y: {
                type: 'linear',
                display: true,
                position: 'left',
                title: {
                  display: true,
                  text: 'ë§¤ì¶œ (ì–µì›)'
                }
              },
              y1: {
                type: 'linear',
                display: true,
                position: 'right',
                title: {
                  display: true,
                  text: 'ë‹¤ìš´ë¡œë“œ (ë§ŒíšŒ)'
                },
                grid: {
                  drawOnChartArea: false
                }
              }
            }
          }
        });
      }
    } catch (error) {
      console.error('ì›”ë³„ ì¶”ì´ ì°¨íŠ¸ ì˜¤ë¥˜:', error);
    }

    // 3. ROI ì°¨íŠ¸ (ìƒìœ„ 10ê°œ ê²Œì„ì‚¬)
    try {
      const roiCtx = document.getElementById('roiChart');
      if (roiCtx && <%= reportData.efficiency && reportData.efficiency.companyEfficiency ? 'true' : 'false' %>) {
        const topROI = <%- JSON.stringify((reportData.efficiency.companyEfficiency || []).slice(0, 10)) %>;
        if (topROI.length > 0) {
          new Chart(roiCtx.getContext('2d'), {
            type: 'bar',
            data: {
              labels: topROI.map(c => c.companyName),
              datasets: [{
                label: 'ROI (ë°°)',
                data: topROI.map(c => c.roi),
                backgroundColor: topROI.map(c => c.isExcellent ? chartColors.green : chartColors.blue)
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              indexAxis: 'y',
              plugins: {
                legend: {
                  display: false
                },
                title: {
                  display: true,
                  text: 'ê²Œì„ì‚¬ë³„ íˆ¬ì íš¨ìœ¨ì„± (ROI) - Top 10'
                }
              },
              scales: {
                x: {
                  beginAtZero: true,
                  title: {
                    display: true,
                    text: 'ROI (ë°°)'
                  }
                }
              }
            }
          });
        }
      }
    } catch (error) {
      console.error('ROI ì°¨íŠ¸ ì˜¤ë¥˜:', error);
    }
  </script>
</body>
</html>

